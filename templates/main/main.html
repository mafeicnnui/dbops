<head>
    <meta charset="utf-8">
    <style>
        #db-backup-prod, #db-sync-prod {
            width: 100% !important;
        }

        .color-warning {
            color: red;
            font-size: 30px;
        }

        .color-success {
            color: #44d954;
            font-size: 30px;
        }

        .table > thead > tr > th {
            font-weight: normal !important;
            background-color: #73786f;
            color: #dbe2d5;
            text-align: center;
        }

        .color-warning {
            color: red;
            font-size: 30px;
        }

        .color-success {
            color: #44d954;
            font-size: 30px;
        }

        .modal-lg-detail {
            width: 45%;
            height: 60%;
            margin-left: 500px;
            margin-top: 50px;
        }

        .fixed-panel {
            min-height: 180px;
        }

        #hopson_order_num {
            width: 100%;
            height: 200px;
        }

        #monitor_review {
            width: 1000px;
            height: 280px;
        }

        .modal-lg-detail {
            width: 60%;
            height: 55%;
            max-height: 300px;
        }

        label {
            display: inline-block;
            width: 150px;
            text-align: right;
        }

    </style>
</head>
<body>
<br>
<div class="row">
    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-chart-areaspline widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">用户数</p>
                <h2><span id='user_num'></span>人 <small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-account-convert widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">数据源</p>
                <h2><span id='db_source_num'></span>个 <small><i class="mdi mdi-arrow-down text-danger"></i></small>
                </h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-layers widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">服务器</p>
                <h2><span id='server_num'></span>台 <small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-av-timer widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">问题单</p>
                <h2><span id='wtd_num'></span>个 <small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->
    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-av-timer widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">SQL工单</p>
                <h2><span id='sql_num'></span>个 <small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-av-timer widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">代理服务</p>
                <h2><span id='agent_num'></span>个 <small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->
</div>
<div class="row">
    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-account-multiple widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">备份任务</p>
                <h2><span id='backup_task_num'></span>个<small><i class="mdi mdi-arrow-down text-danger"></i></small>
                </h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-download widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">同步任务</p>
                <h2><span id='sync_task_num'></span>个<small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-chart-areaspline widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">监控任务</p>
                <h2><span id='stats_task_num'></span>个<small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-account-convert widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">慢日志任务</p>
                <h2><span id='slow_task'></span>个<small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-layers widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">图片任务</p>
                <h2><span id='minio_task'></span>个<small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->

    <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card-box widget-box-one">
            <i class="mdi mdi-av-timer widget-one-icon"></i>
            <div class="wigdet-one-content">
                <p class="m-0 text-uppercase font-600 font-secondary text-overflow">归档任务</p>
                <h2><span id='archive_task'></span>个<small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
            </div>
        </div>
    </div><!-- end col -->
</div>

<!--工单情况 -->
<div id='div-order' class="panel panel-default">
    <div class="panel-body">
        <ul class="nav nav-pills m-b-30 pull-left">
            <li class="active">
                <a href="#hopsonone-order" data-toggle="tab" aria-expanded="true">数据库工单</a>
            </li>
        </ul>
        <div class="tab-content br-n pn">
            <div class="panel-body fixed-panel">
                <div id='hopson_order_num'></div>
            </div>
        </div>
    </div>
</div>

<!--数据库备份情况 -->
<div id='div-backup' class="panel panel-default">
    <div class="panel-body">
        <ul class="nav nav-pills m-b-30 pull-left">
            <li class="active">
                <a href="#hopsonone-backup" data-toggle="tab" aria-expanded="true">数据库备份</a>
            </li>
        </ul>
        <div class="tab-content br-n pn">
            <div class="tab-pane active" id="hopsonone-backup-prod">
                <table id="db-backup-prod" class="table table-striped table-bordered dt-responsive nowrap"
                       cellspacing="0" width="100%" height="100%"></table>
                <span id='backup-num'></span>
            </div>
        </div>
    </div>
</div>
</div>

<!--数据库同步情况 -->
<div d='div-sync' class="panel panel-default">
    <div class="panel-body">
        <ul class="nav nav-pills m-b-30 pull-left">
            <li class="active">
                <a href="#hopsonone-sync" data-toggle="tab" aria-expanded="true">数据库同步</a>
            </li>
        </ul>
        <div class="tab-content br-n pn">
            <div class="tab-pane active" id="hopsonone-sync-prod">
                <table id="db-sync-prod" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0"
                       width="100%" height="100%"></table>
                <span id='sync-num'></span>
            </div>
        </div>
    </div>
</div>
</div>

<!--任务详情窗口 -->
<div id="con-modal-sync-task" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg-detail">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">任务详情</h4>
            </div>
            <div class="modal-body">
                <div class="panel panel-flat">
                    <div class="panel-body">
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">任务名称：</label>
                                </div>
                                <div class="col-md-10">
                                    <input type="text" id="sync_comments" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">同步标识号</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="sync_tag" type="text" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">源数据库名</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="sync_schema" type="text" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">全量批大小</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="sync_batch_size" type="text" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">增量批大小</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="sync_batch_size_incr" type="text" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">运行时间</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="run_time" type="text" readonly class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div>
                                    <label class="col-md-2 control-label">最近同步时间</label>
                                </div>
                                <div class="col-md-10">
                                    <input id="last_sync_time" type="text" readonly class="form-control">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-sm-offset-3 col-sm-4">
                        <button type="button" class="btn btn-custom waves-effect waves-light btn-md"
                                data-dismiss="modal">关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function get_charts(p_item, p_title, p_x_data, p_y_data, p_color) {
        var myChart = echarts.init($('#' + p_item)[0]);
        var option = {
            title: {
                text: p_title,
                left: 'center',
                textStyle: {
                    color: '#a4a4a4',
                    fontStyle: 'italic',
                    fontWeight: 'bold',
                    fontFamily: '宋体',
                    fontSize: 10
                }
            },
            grid: {
                top: '25px',
                bottom: '20px',
                right: '15px',
                left: '20px'
            },
            xAxis: {
                type: 'category',
                splitLine: {
                    show: false
                },
                axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 8}},
                axisTick: {show: false},
                data: p_x_data
            },
            yAxis: {
                type: 'value',
                splitLine: {
                    show: false
                },
                axisTick: {show: false},
                splitLine: {show: false},
                axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 8}},
                axisLine: {show: true, lineStyle: {color: '#6173A3'}},
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#6a7985'
                    }
                }
            },
            series: [{
                data: p_y_data,
                type: 'line',
                itemStyle: {
                    normal: {
                        lineStyle: {
                            color: p_color
                        }
                    }
                },
                showAllSymbol: false,
                symbolSize: 1,
                smooth: true
            }]
        };
        myChart.setOption(option);
    }

    function get_charts_large(p_item, p_title, p_x_data, p_y_data, p_color) {
        var myChart = echarts.init($('#' + p_item)[0]);
        var option = {
            title: {
                text: p_title,
                left: 'center',
                textStyle: {
                    color: '#9ea7c4',
                    fontWeight: 'bold',
                    fontFamily: '宋体',
                    fontSize: 12
                }
            },
            grid: {
                top: '25px',
                bottom: '60px',
                right: '15px',
                left: '30px'
            },
            xAxis: {
                type: 'category',
                splitLine: {
                    show: false
                },
                axisLine: {show: true, lineStyle: {color: '#329ba3'}},
                axisLabel: {
                    textStyle:
                        {
                            color: '#9ea7c4',
                            fontSize: 8,
                            fontStyle: 'italic',
                            fontWeight: 'bold'
                        }
                },
                axisTick: {show: false},
                data: p_x_data
            },
            yAxis: {
                type: 'value',
                splitLine: {
                    show: false
                },
                margin: 5,
                rotate: 60,
                axisTick: {show: false},
                splitLine: {show: false},
                axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 8}},
                axisLine: {show: true, lineStyle: {color: '#6173A3'}},
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#83d5a5'
                    }
                }
            },
            toolbox: {
                show: true,
                feature: {
                    saveAsImage: {
                        show: true,
                        excludeComponents: ['toolbox'],
                        pixelRatio: 1
                    }
                }
            },
            series: [{
                data: p_y_data,
                type: 'line',
                itemStyle: {
                    normal: {
                        lineStyle: {
                            color: p_color
                        }
                    }
                },
                showAllSymbol: false,
                symbolSize: 1,
                smooth: true
            }]
        };
        myChart.setOption(option);
    }

    function get_charts_bar(p_item, p_title, p_x_data, p_y_data, p_color) {
        var myChart = echarts.init($('#' + p_item)[0], 'light');
        var option = {
            title: {
                text: p_title,
                left: 'center',
                textStyle: {
                    color: '#a4a4a4',
                    fontStyle: 'italic',
                    fontWeight: 'bold',
                    fontFamily: '宋体',
                    fontSize: 10
                }
            },
            grid: {
                top: '25px',
                bottom: '20px',
                right: '15px',
                left: '20px'
            },
            xAxis: {
                type: 'category',
                splitLine: {
                    show: false
                },
                axisLine: {show: true, lineStyle: {color: '#6173A3'}},
                axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 8}},
                axisTick: {show: false},
                data: p_x_data
            },
            yAxis: {
                type: 'value',
                splitLine: {
                    show: false
                },
                axisTick: {show: false},
                splitLine: {show: false},
                axisLabel: {textStyle: {color: '#9ea7c4', fontSize: 8}},
                axisLine: {show: true, lineStyle: {color: '#6173A3'}},
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#6a7985'
                    }
                }
            },
            legend: {
                data: ['合生通', '会付通', '梧桐']
            },
            series: [{
                name: '合生通',
                data: p_y_data[0],
                type: 'bar',
                showAllSymbol: false,
                symbolSize: 1,
                smooth: true
                },
                {
                    name: '会付通',
                    data: p_y_data[1],
                    type: 'bar',
                    showAllSymbol: false,
                    symbolSize: 1,
                    smooth: true
                }, {
                    name: '梧桐',
                    data: p_y_data[2],
                    type: 'bar',
                    showAllSymbol: false,
                    symbolSize: 1,
                    smooth: true
                }
            ]
        };
        myChart.setOption(option);
    }

    function set_sync_task(dataSet, max_syrq, sync_sts) {
        $('#sync_comments').val(dataSet['comments'])
        $('#sync_tag').val(dataSet['sync_tag'])
        $('#sync_schema').val(dataSet['sync_schema'])
        $('#sync_batch_size').val(dataSet['batch_size'])
        $('#sync_batch_size_incr').val(dataSet['batch_size_incr'])
        $('#run_time').val(dataSet['run_time'])
        $('#last_sync_time').val(max_syrq)
        if (sync_sts == '1') {
            $("#last_sync_time").css("color", "red");
        } else {
            $("#last_sync_time").css("color", "black");
        }
    }

    function get_title_by_id(p_id) {
        var id = 'title_' + p_id.split('_')[p_id.split('_').length - 1];
        return $('#' + id).text()
    }

    function get_contents_from_div(p_id, p_render_id) {
        var db_id = p_id.split('_')[p_id.split('_').length - 1];
        if (p_id.indexOf("total") >= 0) {
            $.ajax({
                url: "/get/db/active/num",
                type: "post",
                data: {
                    'db_id': db_id,
                    'begin_date': $('#begin_date').val(),
                    'end_date': $('#end_date').val()
                },
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts(p_render_id, '总连接数', dataSet['amount']['x_total'], dataSet['amount']['y_total'], '#6495ED')
                    get_charts(p_render_id.replace('total', 'active'), '活跃连接数', dataSet['amount']['x'], dataSet['amount']['y'], '#6495ED')
                    get_charts(p_render_id.replace('total', 'qps'), '每秒查询数', dataSet['amount']['x_qps'], dataSet['amount']['y_qps'], '#6495ED')
                    get_charts(p_render_id.replace('total', 'tps'), '每秒事务数', dataSet['amount']['x_tps'], dataSet['amount']['y_tps'], '#6495ED')
                }
            });

        } else if (p_id.indexOf("order") >= 0) {
            $.ajax({
                url: "/get/db/order/num",
                type: "post",
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts_bar(p_render_id, '', dataSet['amount']['x'], dataSet['amount']['y'], '#6495ed')
                }
            });
        }
    }

    function get_contents_from_div_large(p_id, p_render_id) {
        var dbid = p_id.split('_')[p_id.split('_').length - 1];
        if (p_id.indexOf("total") >= 0) {
            var inst_id = p_id.split('_')[p_id.split('_').length - 2];
            $.ajax({
                url: "/get/db/active/num",
                type: "post",
                data: {
                    'db_id': dbid,
                    'begin_date': $('#begin_date').val(),
                    'end_date': $('#end_date').val()
                },
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts_large(p_render_id, '总连接数', dataSet['amount']['x_total'], dataSet['amount']['y_total'], '#edc4a7')
                }
            });

        } else if (p_id.indexOf("active") >= 0) {
            $.ajax({
                url: "/get/db/active/num",
                type: "post",
                data: {
                    'db_id': dbid,
                    'begin_date': $('#begin_date').val(),
                    'end_date': $('#end_date').val()
                },
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts_large(p_render_id, '活跃连接数', dataSet['amount']['x'], dataSet['amount']['y'], '#99a347')
                }
            });
        } else if (p_id.indexOf("qps") >= 0) {
            $.ajax({
                url: "/get/db/active/num",
                type: "post",
                data: {
                    'db_id': dbid,
                    'begin_date': $('#begin_date').val(),
                    'end_date': $('#end_date').val()
                },
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts_large(p_render_id, '每秒查询数', dataSet['amount']['x_qps'], dataSet['amount']['y_qps'], '#a47278')
                }
            });

        } else if (p_id.indexOf("tps") >= 0) {
            $.ajax({
                url: "/get/db/active/num",
                type: "post",
                data: {
                    'db_id': dbid,
                    'begin_date': $('#begin_date').val(),
                    'end_date': $('#end_date').val()
                },
                datatype: "json",
                beforeSend: function () {
                    start_Loader(p_render_id)
                },
                complete: function () {
                    end_Loader(p_render_id)
                },
                success: function (dataSet) {
                    get_charts_large(p_render_id, '每秒事务数', dataSet['amount']['x_tps'], dataSet['amount']['y_tps'], '#6495ed')
                }
            });

        }
    }

    function set_sys_status_values() {
        $.ajax({
            url: "/get/sys/stats/idx",
            type: "post",
            datatype: "json",
            beforeSend: function () {
                start_Loader('user_num')
                start_Loader('db_source_num')
                start_Loader('server_num')
                start_Loader('wtd_num')
                start_Loader('sql_num')
                start_Loader('agent_num')
                start_Loader('backup_task_num')
                start_Loader('sync_task_num')
                start_Loader('stats_task_num')
                start_Loader('slow_task')
                start_Loader('minio_task')
                start_Loader('archive_task')
            },
            complete: function () {
                end_Loader('user_num')
                end_Loader('db_source_num')
                end_Loader('server_num')
                end_Loader('wtd_num')
                end_Loader('sql_num')
                end_Loader('agent_num')
                end_Loader('backup_task_num')
                end_Loader('sync_task_num')
                end_Loader('stats_task_num')
                end_Loader('slow_task')
                end_Loader('minio_task')
                end_Loader('archive_task')
            },
            success: function (dataSet) {
                $('#user_num').text(dataSet['user_num'])
                $('#db_source_num').text(dataSet['db_source_num'])
                $('#server_num').text(dataSet['server_num'])
                $('#wtd_num').text(dataSet['wtd_num'])
                $('#sql_num').text(dataSet['sql_num'])
                $('#agent_num').text(dataSet['agent_num'])
                $('#backup_task_num').text(dataSet['backup_task_num'])
                $('#sync_task_num').text(dataSet['sync_task_num'])
                $('#stats_task_num').text(dataSet['stats_task_num'])
                $('#slow_task').text(dataSet['slow_task'])
                $('#minio_task').text(dataSet['minio_task'])
                $('#archive_task').text(dataSet['archive_task'])
            }
        });
    }

    $(document).ready(function () {
        $('#begin_date').val(GetDate(3));
        $('#end_date').val(GetDate(2));
        set_sys_status_values();

        $.ajax({
            url: "/backup_case",
            type: "post",
            datatype: "json",
            data: {
                'token': window.localStorage.getItem("token"),
                db_env: '1,2,3,4,6'
            },
            beforeSend: function () {
                start_Loader('div-backup')
            },
            complete: function () {
                end_Loader('div-backup')
            },
            success: function (dataSet) {
                $('#db-backup-prod').DataTable({
                    "stripeClasses": ['cell-border', 'cell-border', 'cell-border'],
                    "dom": '<"top"<"clear">>rt<"bottom"ip<"clear">>',
                    destroy: true,
                    async: true,
                    ordering: true,
                    scrollY: true,
                    scrollX: true,
                    paging: true,
                    iDisplayLength: 6,
                    data: dataSet.data,
                    autoFill: true,
                    bAutoWidth: true,
                    info: true,
                    columns: [
                        {"title": "数据源描述", "width": "20%"},
                        {"title": "数据库类型", "width": "10%"},
                        {"title": "开始时间", "width": "15%"},
                        {"title": "结束时间", "width": "15%"},
                        {"title": "备份大小[M]", "width": "15%"},
                        {"title": "备份时长[s]", "width": "15%"},
                        {"title": "备份状态", "width": "10%"},
                    ],
                    columnDefs: [
                        {
                            targets: 6,
                            render: function (data, type, row, meta) {
                                if (row[6] == '√') {
                                    b = '<i class="ion-ios7-lightbulb color-success"></i>'
                                    return b
                                } else {
                                    b = '<i class="ion-ios7-bell color-warning"></i>'
                                    return b
                                }
                            }
                        }
                    ],
                    "language": get_languages()
                });
                if (dataSet['failure'] > 0) {
                    $('#backup-num').html('成功：' + dataSet['success'] + '个,失败:<font color="#FF0000">' + dataSet['failure'] + '</font> 个')
                } else {
                    $('#backup-num').html('成功：' + dataSet['success'] + '个,失败:' + dataSet['failure'] + '个')
                }
            }
        });

        $.ajax({
            url: "/sync_case",
            type: "post",
            datatype: "json",
            data: {
                'token': window.localStorage.getItem("token"),
                sync_ywlx: '1'
            },
            beforeSend: function () {
                start_Loader('div-sync')
            },
            complete: function () {
                end_Loader('div-sync')
            },
            success: function (dataSet) {
                $('#db-sync-prod').DataTable({
                    "stripeClasses": ['cell-border', 'cell-border', 'cell-border'],
                    "dom": '<"top"<"clear">>rt<"bottom"ip<"clear">>',
                    destroy: true,
                    async: true,
                    ordering: false,
                    scrollY: true,
                    scrollX: true,
                    paging: true,
                    iDisplayLength: 20,
                    data: dataSet.data,
                    autoFill: true,
                    bAutoWidth: true,
                    info: true,
                    columns: [
                        {"title": "项目代码", "width": "5%"},
                        {"title": "项目名称", "width": "12%"},
                        {
                            "title": "离线客流",
                            "width": "9%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[2].split(',').length; i++) {
                                    var status = row[2].split(',')[i].split('@')[0]
                                    var syncid = row[2].split(',')[i].split('@')[1]
                                    var rqq = row[2].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {
                            "title": "实时客流",
                            "width": "9%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[3].split(',').length; i++) {
                                    var status = row[3].split(',')[i].split('@')[0]
                                    var syncid = row[3].split(',')[i].split('@')[1]
                                    var rqq = row[3].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {
                            "title": "客流设备",
                            "width": "9%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[4].split(',').length; i++) {
                                    var status = row[4].split(',')[i].split('@')[0]
                                    var syncid = row[4].split(',')[i].split('@')[1]
                                    var rqq = row[4].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {
                            "title": "离线车流",
                            "width": "9%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[5].split(',').length; i++) {
                                    var status = row[5].split(',')[i].split('@')[0]
                                    var syncid = row[5].split(',')[i].split('@')[1]
                                    var rqq = row[5].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {
                            "title": "实时车流",
                            "width": "9%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[6].split(',').length; i++) {
                                    var status = row[6].split(',')[i].split('@')[0]
                                    var syncid = row[6].split(',')[i].split('@')[1]
                                    var rqq = row[6].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {
                            "title": "德利多付",
                            "width": "5%",
                            "className": 'table_td_center',
                            "render": function (data, type, row, meta) {
                                var tmp = '';
                                var result = '';
                                for (i = 0; i < row[7].split(',').length; i++) {
                                    var status = row[7].split(',')[i].split('@')[0]
                                    var syncid = row[7].split(',')[i].split('@')[1]
                                    var rqq = row[7].split(',')[i].split('@')[2]
                                    if (status == '1') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-warning"></i>'
                                    } else if (status == '0') {
                                        tmp = '<i id="' + status + '@' + syncid + '@' + rqq + '" class="ion-ios7-lightbulb color-success"></i>'
                                    } else {
                                        tmp = ''
                                    }
                                    result = result + '&nbsp;&nbsp;' + tmp + '&nbsp;&nbsp;';
                                }
                                return result
                            }
                        },
                        {"title": "生成时间", "width": "9%"},
                    ],
                    "language": get_languages()
                });
                if (dataSet['failure'] > 0) {
                    $('#sync-num').html('成功：' + dataSet['success'] + '个,失败:<font color="#FF0000">' + dataSet['failure'] + '</font> 个')
                } else {
                    $('#sync-num').html('成功：' + dataSet['success'] + '个,失败:' + dataSet['failure'] + '个')
                }
            },
        });

        $(".fixed-panel>div").each(function () {
            id = $(this).attr('id');
            if (!(id === undefined) && (id != 'monitor_review') && (id.indexOf('total') >= 0)) {
                get_contents_from_div(id, id)
            }

            if (!(id === undefined) && (id != 'monitor_review') && (id.indexOf('order') >= 0 || id.indexOf('real_sync') >= 0)) {
                get_contents_from_div(id, id)
            }
        });

    });

    $("#db-sync-prod").on("click", "td i", function () {
        var sync_sts = $(this).attr('id').split('@')[0];
        var sync_tag = $(this).attr('id').split('@')[1];
        var max_syrq = $(this).attr('id').split('@')[2];
        $.ajax({
            url: "/get/sync",
            type: "post",
            datatype: "json",
            data: {
                sync_tag: sync_tag,
            },
            success: function (dataSet) {
                $('.modal').on('show.bs.modal', centerModals);
                $(window).on('resize', centerModals);
                set_sync_task(dataSet, max_syrq, sync_sts);
                $('#con-modal-sync-task').modal({
                    keyboard: false,
                    backdrop: false
                });
            },
        })
    })

    $('.fixed-panel>div').click(function () {
        var id = $(this).attr('id');
        $('#begin_date').val(GetDate(3));
        $('#end_date').val(GetDate(2));
        get_contents_from_div_large(id, 'monitor_review');
        $('#monitor_review_title').text(get_title_by_id(id));
        $('#monitor_review_title_hidden').val(id);
        $('.modal').on('show.bs.modal', centerModals);
        $(window).on('resize', centerModals);
        $('#con-modal-img-win').modal({
            keyboard: false,
            backdrop: false
        });
    });

    $('#query_btn').click(function () {
        id = $('#monitor_review_title_hidden').val()
        get_contents_from_div(id, 'monitor_review');
    });

</script>

</body>